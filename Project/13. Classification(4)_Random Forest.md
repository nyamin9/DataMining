# 2022-1 í•™ê¸° ë°ì´í„°ë§ˆì´ë‹ í”„ë¡œì íŠ¸_(12)  

ğŸ ì €ë²ˆ ê¸€ì—ì„œëŠ” ìš°ë¦¬ê°€ ì—°ê´€ê´€ê³„ ë¶„ì„ì„ í†µí•´ ì–»ì€ attribute set 5ì™€ ì „ì²˜ë¦¬ë§Œì„ ìˆ˜í–‰í•œ ë°ì´í„°, PCA ê²°ê³¼ ë§Œë“¤ì–´ì§„ ì£¼ì„±ë¶„ 3ê°€ì§€ ê²½ìš°ì— ëŒ€í•´ ê²°ì • íŠ¸ë¦¬ ëª¨ë¸ì„ ë§Œë“¤ì—ˆë‹¤. ì´ë²ˆ ê¸€ì—ì„œëŠ” ê²°ì • íŠ¸ë¦¬ë“¤ì´ ëª¨ì—¬ ë§Œë“¤ì–´ì§€ëŠ” ëœë¤ í¬ë ˆìŠ¤íŠ¸ë¥¼ í†µí•´ ëª¨ë¸ì˜ ì˜ˆì¸¡ë ¥ì„ ì‹œí—˜í•´ë³´ë„ë¡ í•˜ì.<br>  

ğŸ ì´ë ‡ê²Œ ë§Œë“  ëœë¤ í¬ë ˆìŠ¤íŠ¸ì— ëŒ€í•´ì„œ ROC Curveì™€ Confusion Matrixë¥¼ ë§Œë“¤ì–´ ê° ëª¨ë¸ë“¤ì˜ ì„±ëŠ¥ì´ ì–´ë–¤ì§€ ì§ê´€ì ìœ¼ë¡œ ë¹„êµí•´ë³¼ ê²ƒì´ë‹¤.  

***  

## 1. Attribute Set 5 [age, aphi, aplo, cholesterol, gluc, BMI, active] Random Forest  

ğŸ“Œ ë¨¼ì € ì‚¬ìš©í•  ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.  

```py
# ë°ì´í„° ì…‹ì„ train / test ë¡œ ë¶„ë¥˜í•´ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬
from sklearn.model_selection import train_test_split 

# ëœë¤í¬ë ˆìŠ¤íŠ¸ë¥¼ ìœ„í•œ ë°ì´í„° ì •ê·œí™” - StandardScaler ë¼ì´ë¸ŒëŸ¬ë¦¬
# ëœë¤í¬ë ˆìŠ¤íŠ¸ ìƒì„± RandomForestClassifier ë¼ì´ë¸ŒëŸ¬ë¦¬
# acuuracy_score ë¼ì´ë¸ŒëŸ¬ë¦¬ : ì •í™•ë„ ê³„ì‚° í•¨ìˆ˜
from sklearn.preprocessing import StandardScaler
from sklearn.ensemble import RandomForestClassifier
from sklearn.ensemble import GradientBoostingClassifier
from sklearn.metrics import accuracy_score 

# ROC Curve, Confusion Matrix, classification report ìƒì„±ì„ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬
from sklearn.metrics import roc_curve, auc
from sklearn.metrics import (
    classification_report, confusion_matrix,
    ConfusionMatrixDisplay)
from enum import Enum
```  

ğŸ“Œ ëœë¤ í¬ë ˆìŠ¤íŠ¸ë¥¼ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì€ ê²°ì • íŠ¸ë¦¬ì™€ í¬ê²Œ ë‹¤ë¥´ì§€ ì•Šë‹¤. ê°€ì§€ê³  ìˆëŠ” ë°ì´í„°ë¥¼ train setê³¼ test setìœ¼ë¡œ ë‚˜ëˆ ì£¼ê³ , ëœë¤ í¬ë ˆìŠ¤íŠ¸ ëª¨ë“ˆì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤.  
ğŸ“Œ ì´ë•Œ ìš°ë¦¬ê°€ ì •í•´ì¤„ ê²ƒì€ í¬ë ˆìŠ¤íŠ¸ì— ìœ„ì¹˜í•  ê° íŠ¸ë¦¬ë“¤ì˜ ìµœëŒ€ ê¹Šì´ì¸ë°, ìš°ë¦¬ëŠ” 12ì¼ë•Œ ê·¸ ê²°ê³¼ê°€ ê°€ì¥ ì¢‹ê²Œ ë‚˜ì™”ê¸° ë•Œë¬¸ì— max_depthë¥¼ 12ë¡œ ì„¤ì •í–ˆë‹¤.  

```py
# attribute set 5ë¥¼ ì‚¬ìš©í•œ ê²½ìš°
cardio.target_out = cardio['cardio'].copy()
cardio.feat_out = cardio.drop(['cardio','gender','alco','smoke'], axis = 1).copy()

train_x_out, test_x_out, train_y_out, test_y_out = train_test_split(cardio.feat_out, cardio.target_out, test_size=0.3, random_state=0)

# ë°ì´í„° í‘œì¤€í™” ì‘ì—…
sc = StandardScaler()
sc.fit(train_x_out)

# í‘œì¤€í™”ëœ ë°ì´í„°ì…‹
train_x_out_std = sc.transform(train_x_out)
test_x_out_std = sc.transform(test_x_out)

clf = RandomForestClassifier(random_state=0, max_depth = 12, n_estimators = 200)
clf.fit(train_x_out,train_y_out)

predict6 = clf.predict(train_x_out)
predict5 = clf.predict(test_x_out)

print("Train set accuracy : ", accuracy_score(train_y_out, predict6))
print("Test set accuracy : ", accuracy_score(test_y_out,predict5))
```  

```
>>
Train set accuracy :  0.7655592469545958
Test set accuracy :  0.7276485788113695
```  

***  

## 2. Original Data Random Forest  

```py
# original dataì˜ ëª¨ë“  attributeë¥¼ ì‚¬ìš©í•œ ê²½ìš° : case 1
cardio.target_all = cardio['cardio'].copy()
cardio.feat_all = cardio.drop(['cardio'], axis = 1).copy()

train_x_all, test_x_all, train_y_all, test_y_all = train_test_split(cardio.feat_all, cardio.target_all, test_size=0.3, random_state=0)

# ë°ì´í„° í‘œì¤€í™” ì‘ì—…
sc = StandardScaler()
sc.fit(train_x_all)

# í‘œì¤€í™”ëœ ë°ì´í„°ì…‹
train_x_std_all = sc.transform(train_x_all)
test_x_std_all = sc.transform(test_x_all)

clf = RandomForestClassifier(random_state=0, max_depth = 12, n_estimators = 200)
clf.fit(train_x_all,train_y_all)

predict4 = clf.predict(train_x_all)
predict3 = clf.predict(test_x_all)

print("Train set accuracy : ", accuracy_score(train_y_all, predict4))
print("Test set accuracy : ", accuracy_score(test_y_all,predict3))  
```  
```
>>
Train set accuracy :  0.7690586932447397
Test set accuracy :  0.7299741602067183
```  

ğŸš© ì´ë ‡ê²Œ original dataì— ëŒ€í•´ ë§Œë“¤ì–´ì§„ ëœë¤ í¬ë ˆìŠ¤íŠ¸ë¥¼ ë°”íƒ•ìœ¼ë¡œ ROC Curveì™€ Confusion Matrixë¥¼ ì‹œê°í™”í•  ê²ƒì´ë‹¤.<br>  

```py
# ROC Curve
# ì „ì²´ attributeë¥¼ ì‚¬ìš©í•œ ê²½ìš°ì˜ ROC curve ì¶œë ¥
fpr_tr, tpr_tr, ths_tr = roc_curve(test_y_all, predict3)
auc_tr = auc(fpr_tr, tpr_tr)

fig = plt.figure(figsize = (8,4))
plt.subplot(121)
plt.plot(fpr_tr, tpr_tr, 
        lw=3, label='ROC curve (area = %0.2f)' % auc_tr)
plt.plot([0, 1], [0, 1], color='skyblue', lw=2,linestyle='--')
plt.xlabel('fpr')
plt.ylabel('tpr')
plt.legend(loc="lower right", prop={'size' : 10})
plt.title('validation set')
plt.show()  



# Confusion Matrix
# ì „ì²´ attributeë¥¼ ì‚¬ìš©í•œ ê²½ìš°ì˜ confusion matrix ì¶œë ¥
class Diagnosis(Enum):
    No_Cardio = 0
    Cardio = 1    
    
cm = confusion_matrix(
    test_y_all,
    (predict3>.5).astype(np.int8),
#    normalize='true',
)
disp = ConfusionMatrixDisplay(
    confusion_matrix=cm,
    display_labels=[d.name for d in Diagnosis],
)
disp.plot(ax=plt.subplots(1, 1, facecolor='white')[1], cmap=plt.cm.Reds)
```  

<p align="center"><img src="https://user-images.githubusercontent.com/65170165/200122701-a182b5fe-3a5a-4689-8836-d2b4aa6a219d.jpg" width="320" /><img src="https://user-images.githubusercontent.com/65170165/200122702-d36ca164-99f3-48ab-a67f-1f5ad0b2b2b4.jpg" width="400" /></p><br>  


ğŸ“Œ original dataì— ëŒ€í•œ random forestì˜ ê²°ê³¼ë¥¼ í•´ì„í•˜ìë©´ ì•„ë˜ì™€ ê°™ë‹¤.  
    - ê²°ì • íŠ¸ë¦¬ë¥¼ ì‚¬ìš©í•œ ê²½ìš°ì— ë¹„í•´ì„œ í–¥ìƒëœ accuracyë¥¼ ë³´ì—¬ì¤Œ  
    - í•˜ì§€ë§Œ ì¢‹ì€ ê²°ê³¼ë¥¼ ì–»ì—ˆë‹¤ê³  í•˜ê¸°ì—” ì–´ë ¤ì›€  
    - ë”°ë¼ì„œ PCAë¥¼ í†µí•œ ëœë¤ í¬ë ˆìŠ¤íŠ¸ë„ ìˆ˜í–‰ ì˜ˆì •  
    
***  

## 3. PCA Dataframe Random Forest  

```py
PCA_df_target = PCA_df['cardio']
PCA_df_feat = PCA_df.drop(['cardio'],axis = 1)

train_x_PCA, test_x_PCA, train_y_PCA, test_y_PCA = train_test_split(PCA_df_feat, PCA_df_target, test_size=0.3, random_state=1)

clf = RandomForestClassifier(random_state=1)
clf.fit(train_x_PCA,train_y_PCA)

predict2 = clf.predict(train_x_PCA)
predict1 = clf.predict(test_x_PCA)

print("Train set accuracy : ", accuracy_score(train_y_PCA, predict2))
print("Test set accuracy : ", accuracy_score(test_y_PCA,predict1))
```  
```
>>
Train set accuracy :  0.9999114064230343
Test set accuracy :  0.7422739018087855
```  

ğŸš© ROC Curveì™€ Confusion Matrixë¥¼ ë§Œë“¤ì–´ë³´ì.<br>  

```py
# PCA DataFrameì„ ì‚¬ìš©í•œ ê²½ìš°ì˜ ROC curve ì¶œë ¥
fpr_tr, tpr_tr, ths_tr = roc_curve(test_y_PCA, predict1)
auc_tr = auc(fpr_tr, tpr_tr)

fig = plt.figure(figsize = (8,4))
plt.subplot(121)
plt.plot(fpr_tr, tpr_tr, 
        lw=3, label='ROC curve (area = %0.2f)' % auc_tr)
plt.plot([0, 1], [0, 1], color='skyblue', lw=2,linestyle='--')
plt.xlabel('fpr')
plt.ylabel('tpr')
plt.legend(loc="lower right", prop={'size' : 10})
plt.title('validation set')
plt.show()  


# PCA DataFrameì„ ì‚¬ìš©í•œ ê²½ìš°ì˜ confusion matrix ì¶œë ¥
class Diagnosis(Enum):
    No_Cardio = 0
    Cardio = 1    
    
cm = confusion_matrix(
    test_y_PCA,
    (predict1>.5).astype(np.int8),
#    normalize='true',
)
disp = ConfusionMatrixDisplay(
    confusion_matrix=cm,
    display_labels=[d.name for d in Diagnosis],
)
disp.plot(ax=plt.subplots(1, 1, facecolor='white')[1], cmap=plt.cm.Blues)
```  
<p align="center"><img src="https://user-images.githubusercontent.com/65170165/200123108-50665335-36fc-4ca6-84fc-6b719631a4ec.jpg" width="301" /><img src="https://user-images.githubusercontent.com/65170165/200123109-948a905d-9f20-41cc-92f8-0ebcf66f3d7c.jpg" width="400" /></p><br>  
