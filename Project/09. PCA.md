# 2022-1 í•™ê¸° ë°ì´í„°ë§ˆì´ë‹ í”„ë¡œì íŠ¸_(9)  

ğŸ ì´ë²ˆ ê¸€ì—ì„œëŠ” PCA (Principal Component Analysis), ì¦‰ ì£¼ì„±ë¶„ ë¶„ì„ì„ í†µí•œ attribute ê°„ì˜ ì—°ê´€ê´€ê³„ë¥¼ íŒŒì•…í•´ë³´ë„ë¡ í•˜ì.<br>  

***  

## 1. PCA ì½”ë“œ êµ¬í˜„  

ğŸ PCAë¶„ì„ì„ ìœ„í•´ sklearn.decomposition ëª¨ë“ˆì˜ PCA ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í–ˆìœ¼ë©°, ì‹œê°í™”ë¥¼ ìœ„í•´ì„œëŠ” plotly ê³µì‹ í™ˆí˜ì´ì§€ë¥¼ ì°¸ê³ í–ˆë‹¤.<br>  

***  

### ğŸš© 1.1. ë°ì´í„° í™•ì¸  


<p align="center"><img src="https://user-images.githubusercontent.com/65170165/187910972-0200d35a-827d-46e5-90d6-a2c89a466825.png" width="800" /></p>

ğŸ ì•ì„œ ì „ì²˜ë¦¬í•œ ë°ì´í„°ë¥¼ ê°€ì§€ê³  PCAë¥¼ ì§„í–‰í•  ê²ƒì´ë‹¤.

* * *  

### ğŸš© 1.2. PCA êµ¬í˜„ ë° ì‹œê°í™”_(Princiapl Component 1~3)  

ğŸ§© ë¨¼ì € ì½”ë“œë¶€í„° í™•ì¸í•´ë³´ë„ë¡ í•˜ìğŸ™„.  

```py
# targetê³¼ feature data ì„¤ì •
# cardioê°€ 0ì¸ objectëŠ” 'N' ìœ¼ë¡œ ë³€í™˜
# cardioê°€ 1ì¸ objectëŠ” 'Y' ë¡œ ë³€í™˜
cardio_target = cardio['cardio'].copy()
cardio_target[cardio_target==0] = 'N'
cardio_target[cardio_target==1] = 'Y'
cardio_feat = cardio.drop('cardio',axis = 1)
```  
```py
# sklearn.decomposition ëª¨ë“ˆì˜ PCA library ì„í¬íŠ¸
# pca.fit_transform() : cardio[features]ë¥¼ scaling í•œ ë’¤ì— principal componentë¡œ ë³€í™˜
# pca.explained_variance_ratio_ : dimensionì— ë”°ë¥¸ variance ì„¤ëª… ì •ë„
pca = PCA()
components = pca.fit_transform(cardio_feat)

# PCA ê²°ê³¼ ì‹œê°í™”
labels = {
    str(i): f"PC {i+1} ({var:.1f}%)"
    for i, var in enumerate(pca.explained_variance_ratio_ * 100)
    }
    
fig = px.scatter_matrix(
    components,
    labels=labels,
    dimensions=range(3),
    color=cardio_target, opacity = 0.5 
    )
    
fig.update_traces(diagonal_visible=False)

fig.show()
```  


- PCAê³¼ì •ì—ì„œ ë§Œë“¤ì–´ì§€ëŠ” Principal Componentì˜ ìˆ˜ì— ë”°ë¼ì„œ ì›ë³¸ ë°ì´í„°ì˜ variance ì„¤ëª… ì •ë„ê°€ ê²°ì •ë˜ê¸° ë•Œë¬¸ì— ì´ dimensionì„ ê²°ì •í•˜ëŠ” ë³€ìˆ˜ê°€ ì¡´ì¬í•œë‹¤. ìœ„ ì½”ë“œì—ì„œ <a>dimensions = range(3)</a>ê°€ ê·¸ ë³€ìˆ˜ì´ë©°, ì´ë¥¼ í†µí•´ PCA ê²°ê³¼ë¥¼ ì‹œê°í™”í•˜ë©´ ì•„ë˜ì™€ ê°™ë‹¤.<br>  

<p align="center"><img src="https://user-images.githubusercontent.com/65170165/182030152-33fa0794-6cf4-44b3-ae93-a5ad30fdc53d.png" width="1000" /></p><br>  

- ê·¸ ê²°ê³¼ targetìœ¼ë¡œ ì„¤ì •í•œ cardio attributê°€ ê°ê° 3ê°œì˜ ì°¨ì›ì—ì„œ ì„¤ëª…ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìœ¼ë©°, PC1ê³¼ PC2ì—ì„œ ëŒ€ë¶€ë¶„ì˜ varianceê°€ ì„¤ëª…ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤ğŸ™ƒ. PCAë¥¼ ê³µë¶€í•œ ë¶„ì´ë¼ë©´ ì•„ì‹œê² ì§€ë§Œ ìœ„ì˜ ê²°ê³¼ëŠ” target labelì— ë”°ë¼ ì„ ëª…í•˜ê²Œ ë¶„ë¥˜ëœ ê²½ìš°ëŠ” ì•„ë‹ˆë‹¤. ê° attributeì— ë”°ë¼ target labelì´ ëª…í™•í•˜ê²Œ ê²°ì •ëœë‹¤ë©´, ìœ„ì˜ ê²½ìš°ì²˜ëŸ¼ ì ë“¤ì´ ê²¹ì¹˜ê¸°ë³´ë‹¤ëŠ” ëª…í™•íˆ êµ¬ë¶„ë˜ëŠ” ê²°ê³¼ê°€ ë‚˜ì˜¤ê²Œ ë˜ë©°, PC1ì—ì„œ 90%ê°€ ë„˜ëŠ” ì„¤ëª…ì •ë„ë¥¼ ê°€ì§„ë‹¤. í•˜ì§€ë§Œ ì´ëŠ” ë°ì´í„°ì˜ ì°¨ì´ë¼ê³  ë³¼ìˆ˜ ìˆê¸° ë•Œë¬¸ì—, ê·¸ë ‡ê²Œ ì‹ ê²½ì“¸ ë¶€ë¶„ì€ ì•„ë‹ ê²ƒì´ë¼ ìƒê°í•˜ê³  í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í–ˆë‹¤.<br>  

- ì´ë²ˆì—ëŠ” dimensionì´ 4ì¸ ê²½ìš°ë¥¼ ì‚´í´ë³´ë„ë¡ í•˜ì.  

* * *

### ğŸš© 1.3. PCA êµ¬í˜„ ë° ì‹œê°í™”_(Princiapl Component 1~4)  

```py
# ì‚¬ìš©í•˜ë ¤ëŠ” principal componenet ê°œìˆ˜ ì •ì˜
n_components = 4

# sklearn.decomposition ëª¨ë“ˆì˜ PCA library ì„í¬íŠ¸. principal componenet ê°œìˆ˜ ì •ì˜.
# pca.fit_transform() : cardio[features]ë¥¼ scaling í•œ ë’¤ì— principal componentë¡œ ë³€í™˜
# pca.explained_variance_ratio_ : dimensionì— ë”°ë¥¸ variance ì„¤ëª… ì •ë„
pca = PCA(n_components=n_components)
components = pca.fit_transform(cardio)

# PCA ê²°ê³¼ ì‹œê°í™”
total_var = pca.explained_variance_ratio_.sum() * 100
labels = {str(i): f"PC {i+1}" for i in range(n_components)}

fig = px.scatter_matrix(
    components,
    color=cardio_target,
    opacity = 0.5,
    dimensions=range(n_components),
    labels=labels,
    title=f'Total Explained Variance: {total_var:.2f}%',
    )
    
fig.update_traces(diagonal_visible=False)

fig.show()
```  

- ìœ„ì˜ ì½”ë“œëŠ” ì•ì„  ì½”ë“œì™€ ë‹¬ë¦¬ <a>n_components</a> ë³€ìˆ˜ë¥¼ í†µí•´ princiapl componentì˜ ê°œìˆ˜ë¥¼ ë¯¸ë¦¬ ì„¤ì •í•´ë‘ê³  PCAë¥¼ ì§„í–‰í•œë‹¤. ê·¸ ê²°ê³¼ëŠ” ì•„ë˜ ê·¸ë¦¼ê³¼ ê°™ë‹¤.<br>  

<p align="center"><img src="https://user-images.githubusercontent.com/65170165/182030776-dce485b0-cced-4163-b286-8a7d341b9e74.png" width="1000" /></p><br>  

- PC4 ê¹Œì§€ ì‚¬ìš©í•œ ê²½ìš°ì— ì›ë³¸ ë°ì´í„°ì˜ varianceë¥¼ 99.58% ê¹Œì§€ ì„¤ëª…í•˜ëŠ” ê²ƒì„ í™•ì¸í–ˆê³ , ì´ì— PCA ë¶„ì„ì„ ìœ„í•´ dimensionì„ 4ë¡œ ì„¤ì •í•˜ê¸°ë¡œ í–ˆë‹¤. ë‹¹ì—°íˆ PCì˜ ìˆ˜ê°€ ëŠ˜ì–´ë‚ ìˆ˜ë¡ ì„¤ëª… ì •ë„ëŠ” ì¦ê°€í•  ê²ƒì´ê¸°ì—, ì´ë¥¼ í™•ì¸í•´ë³´ê¸° ìœ„í•´ì„œ ì‹œê°í™”ë¥¼ ì§„í–‰í•˜ì˜€ë‹¤.  

```py
# dimensionì— ë”°ë¥¸ variance ì„¤ëª… ì •ë„ì˜ ëˆ„ì í•© ì‹œê°í™”
pca = PCA()
pca.fit(cardio)
exp_var_cumul = np.cumsum(pca.explained_variance_ratio_)

px.area(
    x=range(1, exp_var_cumul.shape[0] + 1),
    y=exp_var_cumul,
    labels={"x": "# Components", "y": "Explained Variance"}
)
```  

<p align="center"><img src="https://user-images.githubusercontent.com/65170165/182031175-709f8b31-04fe-4898-bf2a-79cbce30d177.png" width="1000" /></p><br>  

- ì´ ê²°ê³¼ë¥¼ í† ëŒ€ë¡œ dimensionì„ 4ë¡œ ì„¤ì •í•´ì„œ ê° attribute ê°„ì˜ ì—°ê´€ê´€ê³„ë¥¼ ì•Œì•„ë³¼ ê²ƒì´ë‹¤.  

* * *  

### ğŸš© 1.4. attribute ì—°ê´€ê´€ê³„ íŒŒì•…  

ğŸ§© ì•ì„œ ì„¤ëª…í•œ PCAì— ëŒ€í•œ ê°œë…ë§Œ ê°€ì§€ê³ ì„œ ì‹¤ì œë¡œ ì—°ê´€ê´€ê³„ë¥¼ ì–´ë–»ê²Œ ë¶„ì„í•˜ëŠ”ì§€ ì•Œê¸°ëŠ” ì–´ë µë‹¤. ì´ë¥¼ ìœ„í•´ ì‚¬ì´í‚·ëŸ°ê³¼ plotly ì—ì„œëŠ” ê° attributeì˜ ë°©í–¥ì„±ì„ íŒŒì•…í•˜ê¸° ìœ„í•œ ì—¬ëŸ¬ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ”ë°, ì•„ë˜ ì½”ë“œë¥¼ ë³´ê³  ì•Œì•„ë³´ë„ë¡ í•˜ì.  

```py
# vardianceë¥¼ ì„¤ëª…í•˜ëŠ” ë° ì‚¬ìš©ëœ original attribute vectorì˜ ë°©í–¥ì„± íŒŒì•…
X = cardio[cardio_feat.columns]
pca = PCA(n_components=4)
components = pca.fit_transform(X)
loadings = pca.components_.T * np.sqrt(pca.explained_variance_)

fig = px.scatter(components, x=0, y=1, color=cardio_target, opacity = 0.5)
for i, feature in enumerate(X):
    fig.add_shape(
        type='line',
        x0=0, y0=0,
        x1=loadings[i, 0],
        y1=loadings[i, 1],
        line=dict(color="springgreen",width=3.5)
    )
    
    fig.add_annotation(
        x=loadings[i, 0],
        y=loadings[i, 1],
        ax=0, ay=0,
        xanchor="center",
        yanchor="bottom",
        text=feature,
        font = {'color':'white'},
        bgcolor = 'grey'
    )
    
fig.show()
```  

- loadings ë³€ìˆ˜ë¥¼ í†µí•´ ê° attribute vectorì˜ ë°©í–¥ì„ ë‚˜íƒ€ë‚¼ìˆ˜ ìˆë„ë¡ í–ˆê³ , for ë¬¸ì„ ì‚¬ìš©í•´ì„œ ëª¨ë“  pointì™€ vectorë¥¼ ì‹œê°í™”í–ˆë‹¤. ê·¸ ê²°ê³¼ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.<br>  

<p align="center"><img src="https://user-images.githubusercontent.com/65170165/182031756-548a2f09-6240-4dbe-b935-e1b1c091db84.png" width="1000" /></p><br>  

- ì´ ê²°ê³¼ë§Œ ê°€ì§€ê³  ì •í™•í•œ attributeì˜ ë°©í–¥ì„±ì„ íŒŒì•…í•˜ê¸°ì—ëŠ” ê° vectorê°€ ë„ˆë¬´ ê²¹ì³ìˆê¸° ë•Œë¬¸ì—, plotlyì—ì„œëŠ” ì´ë¥¼ í™•ëŒ€í•´ì„œ ë³¼ ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤. í™•ëŒ€í•´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.<br>  

<p align="center"><img src="https://user-images.githubusercontent.com/65170165/182031923-4b6326e8-62d1-47c5-a9aa-a05544d1403c.png" width="1000" /></p><br>  


ğŸ§© PCA ë¶„ì„ì˜ ê²°ê³¼ ì„œë¡œ ê°€ì¥ ì—°ê´€ê´€ê³„ê°€ ê°€ì¥ ë†’ì€ attributeëŠ” ë‹¤ìŒê³¼ ê°™ì´ ê²°ì •ëë‹¤.<br>  


<center><a><b>ap_hi, ap_lo, BMI, gluc, cholestero</b></a></center>  

* * *  

### 1.5. ğŸš© PCA DataFrame  

ğŸ§© ë§ˆì§€ë§‰ìœ¼ë¡œ ìœ„ì˜ ê²°ê³¼ ì„ íƒëœ <a>[ap_hi, ap_lo, BMI, gluc, cholestero]</a> attributeë¥¼ ê°€ì§€ê³  PCA DataFrameì„ ë§Œë“¤ì–´ë³´ìğŸ™‚.<br>  


```py
# PCA Dataframe ì¶œë ¥
pca = PCA(n_components=n_components)
components = pca.fit_transform(cardio)

PCA_df = pd.DataFrame({'PC1' : components[:,0],
             'PC2' : components[:,1],
             'PC3' : components[:,2],
             'PC4' : components[:,3],
             'cardio' : cardio['cardio']})
             
PCA_df
```  

<p align="center"><img src="https://user-images.githubusercontent.com/65170165/182032289-57f4c876-f37d-4cb3-9575-0af0ec376a15.png" width="700" /></p><br>  

- ìœ„ì˜ ë°ì´í„°í”„ë ˆì„ì„ ë³´ë©´ ì²˜ìŒì— 70000 objectê°€ 64500 objectë¡œ ë³€í•œ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆëŠ”ë°, ì´ëŠ” outlierë“¤ì„ ì œê±°í•˜ëŠ” ê³¼ì •ì—ì„œ ìˆ˜ê°€ ì¤„ì–´ë“  ê²ƒì´ë‹¤.  

* * *  

## 2. PCA ì •ë¦¬  

ğŸ§© PCAë¥¼ í†µí•œ ìƒê´€ê´€ê³„ ë¶„ì„ì˜ ê²°ê³¼ëŠ” ì•„ë˜ì™€ ê°™ì´ ì •ë¦¬í•  ìˆ˜ ìˆë‹¤.  
 
- PCA ê²°ê³¼ ì´ 4ê°œì˜ pricipal componentë¡œ 99.58%ì˜ varianceë¥¼ ì„¤ëª…í•  ìˆ˜ ìˆìŒì„ í™•ì¸í–ˆë‹¤.  
- ë˜í•œ original attributeì˜ ë°©í–¥ì„±ì„ ì„¤í´ë³´ë©´ [ap_hi, ap_lo, BMI, gluc, cholesterol] attributeê°€ ì–´ëŠì •ë„ ê°™ì€ ë°©í–¥ìœ¼ë¡œ ë‚˜ì•„ê°€ê³  ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.  

* * *   

ğŸ§© í”„ë¡œì íŠ¸ ì§„í–‰ ê³¼ì •ì—ì„œ ë„ì›€ì„ ë°›ì€ ì‚¬ì´íŠ¸ì™€ ë‚´ ë¸”ë¡œê·¸ì˜ plotly ë¼ì´ë¸ŒëŸ¬ë¦¬ í¬ìŠ¤íŒ…ì„ ê³µìœ í• í…Œë‹ˆ ê¶ê¸ˆí•˜ì‹  ë¶„ë“¤ì€ ë” ì°¸ê³ í•˜ì‹œë©´ ì¢‹ì„ ê²ƒ ê°™ë‹¤ğŸ™ƒğŸ™‚.  

[ğŸ“ PCA Visualization in Python](https://plotly.com/python/pca-visualization/)  

[ğŸ“ Plotly ì‹œê°í™”](https://nyamin9.github.io/pandas_visual/plotly/)  

[ğŸ“ Plotly forë¬¸](https://nyamin9.github.io/pandas_visual/plotly_for_loop/)  

[ğŸ“ PCA ê°œë…](https://nyamin9.github.io/data_mining/Data-Mining-Preprocessing-10/)  

***
