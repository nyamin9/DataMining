# 2022-1 í•™ê¸° ë°ì´í„°ë§ˆì´ë‹ í”„ë¡œì íŠ¸_(10)  

ğŸ ì €ë²ˆ ê¸€ê¹Œì§€ í•´ì„œ ë°ì´í„°ì—ì„œ ì„œë¡œ ì—°ê´€ì´ ìˆëŠ” ëª‡ ê°€ì§€ attributeë“¤ì„ ì¶”ì¶œí•´ëƒˆë‹¤.<br>  

ğŸ ì´ë²ˆ ê¸€ë¶€í„°ëŠ” Decision Treeì™€ Random Forestë¥¼ í†µí•´ì„œ ìš°ë¦¬ê°€ ì°¾ì•„ë‚¸ attributeë“¤ì´ targetì„ ì–¼ë§ˆë‚˜ ì˜ ì˜ˆì¸¡í•  ìˆ˜ ìˆëŠ”ì§€ ì•Œì•„ë³´ë„ë¡ í•˜ì.<br>  

ğŸ ì „ì²˜ë¦¬í•œ ë°ì´í„°ì—ì„œ ì¶”ì¶œí•œ attributeë¥¼ í†µí•´ ì˜ˆì¸¡í•˜ëŠ” ë°©ë²•ê³¼ PCA ë°ì´í„°ë¥¼ í†µí•´ ì˜ˆì¸¡í•˜ëŠ” ë°©ë²• ì¤‘ ì–´ë–¤ ê²ƒì´ ë³´ë‹¤ íš¨ìœ¨ì ì´ë¼ê³  í•  ìˆ˜ ìˆì„ì§€ ì•Œì•„ë³´ëŠ” ê²ƒì´ ì´ í”„ë¡œì íŠ¸ì—ì„œì˜ classification ëª©ì ì´ë‹¤.<br>  

ğŸ ì´ë²ˆ ê¸€ì—ì„œëŠ” í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€ ë°ì´í„°ë“¤ì„ ê°€ì ¸ì˜¬ ê²ƒì´ë‹¤.
***  

## 1. í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„í¬íŠ¸  

ğŸ í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ìš©ë„ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.<br>  
- ë°ì´í„° ì „ì²˜ë¦¬ / ì„í¬íŠ¸  
- ì‹œê°í™”  
- PCA ë¶„ì„
- Decision Tree  
- ë°ì´í„°ì…‹ ë¶„ë¥˜ : train / test  
- Random Forest  
- ROC Curve, Confusion Matrix, Classification report<br>  
   
ğŸ ìƒë‹¹íˆ ë§ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì´ í•„ìš”í•˜ë‹¤. ì•„ë˜ ì½”ë“œ ë°•ìŠ¤ë¡œ ì„¤ëª…í•´ ë‘ì—ˆìœ¼ë‹ˆ ì°¸ê³ í•˜ë©´ ë  ê²ƒ ê°™ë‹¤.<br>  

```py
# ë°ì´í„° ì„í¬íŠ¸ ë° ì „ì²˜ë¦¬ë¥¼ ìœ„í•œ pandas / numpy library ì„í¬íŠ¸
import pandas as pd
import numpy as np

# ì‹œê°í™”ë¥¼ ìœ„í•œ plotly library ì„í¬íŠ¸ 
import plotly.graph_objects as go
import plotly.offline as pyo
pyo.init_notebook_mode()

# ì‹œê°í™”ë¥¼ ìœ„í•œ seaborn, matplotlib ì„í¬íŠ¸
import seaborn as sns
import matplotlib as mpl
import matplotlib.pyplot as plt
import matplotlib.font_manager as fm
%matplotlib inline

# PCA ë¶„ì„ì„ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬
# PCA ì‹œê°í™”ë¥¼ ìœ„í•œ plotly.express ëª¨ë“ˆ ì„í¬íŠ¸
# PCA ë¶„ì„ ìˆ˜í–‰ì„ ìœ„í•œ sklearn.decomposition ëª¨ë“ˆì˜ PCA library ì„í¬íŠ¸
# PCA ë¶„ì„ì„ ìœ„í•œ ë°ì´í„° í‘œì¤€í™” - sklearn.preprocessing ëª¨ë“ˆì˜ StandardScaler library ì„í¬íŠ¸
import plotly.express as px
from sklearn.decomposition import PCA
from sklearn.preprocessing import StandardScaler

# decision treeë¥¼ ìœ„í•œ export_graphviz ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„í¬íŠ¸
# sklearn ëª¨ë“ˆì˜ tree ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„í¬íŠ¸
from sklearn.tree import export_graphviz
import graphviz
from sklearn import tree
from os import system    

# ë°ì´í„° ì…‹ì„ train / test ë¡œ ë¶„ë¥˜í•´ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬
from sklearn.model_selection import train_test_split 

# ëœë¤í¬ë ˆìŠ¤íŠ¸ë¥¼ ìœ„í•œ ë°ì´í„° ì •ê·œí™” - StandardScaler ë¼ì´ë¸ŒëŸ¬ë¦¬
# ëœë¤í¬ë ˆìŠ¤íŠ¸ ìƒì„± RandomForestClassifier ë¼ì´ë¸ŒëŸ¬ë¦¬
# acuuracy_score ë¼ì´ë¸ŒëŸ¬ë¦¬ : ì •í™•ë„ ê³„ì‚° í•¨ìˆ˜
from sklearn.preprocessing import StandardScaler
from sklearn.ensemble import RandomForestClassifier
from sklearn.ensemble import GradientBoostingClassifier
from sklearn.metrics import accuracy_score 

# ROC Curve, Confusion Matrix, classification report ìƒì„±ì„ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬
from sklearn.metrics import roc_curve, auc
from sklearn.metrics import (
    classification_report, confusion_matrix,
    ConfusionMatrixDisplay)
from enum import Enum
```  

***  

## 2. ë°ì´í„° ê°€ì ¸ì˜¤ê¸°  

ğŸ classificationì„ ì§„í–‰í•˜ê¸° ìœ„í•´ì„œ ë°ì´í„°ë¥¼ í•„ìš”í•œ í˜•íƒœë¡œ ê°€ì ¸ì˜¬ ê²ƒì´ë‹¤.<br>  

***  

### ğŸš© 2.1. ì „ì²˜ë¦¬í•œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°  

ğŸ ë¨¼ì € ê°€ì ¸ì˜¬ ë°ì´í„°ëŠ” ì¶”ì¶œí•œ attributeë“¤ë¡œ targetì„ ì˜ˆì¸¡í•˜ê¸° ìœ„í•œ ì „ì²˜ë¦¬ëœ ë°ì´í„°ì´ë‹¤.<br>  

```py
cardio = pd.read_csv('C:\\Users\mingu\Desktop\\cardio_train.csv', sep=';')

# dayê¸°ì¤€ ageë¥¼ year ê¸°ì¤€ìœ¼ë¡œ ë³€í™˜ : 365ë¡œ ë‚˜ëˆ„ê³  ì†Œìˆ˜ì  ì²«ì§¸ìë¦¬ì—ì„œ ë°˜ì˜¬ë¦¼
cardio['age'] = cardio['age'] / 365
cardio['age'] = round(cardio['age'], 0).astype('int64').copy()

# BMI attribute ìƒì„±
cardio['height'] = cardio['height'] / 100
cardio['BMI'] = cardio['weight'] / (cardio['height']**2)
cardio['BMI'] = round(cardio['BMI'], 2).copy()

# id, height, weight attribute ì‚­ì œ
cardio = cardio.drop(['id','height','weight'], axis = 1)

# ìˆ˜ì¶•ê¸°í˜ˆì••ì´ ì´ì™„ê¸°í˜ˆì••ë³´ë‹¤ ë‚®ì€ row ì‚­ì œ
low_drop_index = cardio[(cardio['ap_hi'] < cardio['ap_lo'])].index
cardio = cardio.drop(low_drop_index).copy()

# 90mmHg ì´í•˜, 200mmHg ì´ìƒì˜ Ap_hi í˜ˆì•• ì œê±°
drop_index_sys = cardio[(cardio['ap_hi'] < 90) | (cardio['ap_hi'] > 170)].index
cardio = cardio.drop(drop_index_sys).copy()

# 60mmHg ì´í•˜, 140mmHg ì´ìƒì˜ Ap_lo í˜ˆì•• ì œê±°
drop_index_dias = cardio[(cardio['ap_lo'] < 65) | (cardio['ap_lo'] > 105)].index
cardio = cardio.drop(drop_index_dias).copy()

cardio
```  

<p align="center"><img src="https://user-images.githubusercontent.com/65170165/187910972-0200d35a-827d-46e5-90d6-a2c89a466825.png" width="800" /></p>  

***  

### ğŸš© 2.2. PCA ë°ì´í„°í”„ë ˆì„ ê°€ì ¸ì˜¤ê¸°  

ğŸ PCA ë°ì´í„°ì˜ ì˜ˆì¸¡ë ¥ê³¼ ì¶”ì¶œ attributeì˜ ì˜ˆì¸¡ë ¥ì„ ë¹„êµí•˜ê¸° ìœ„í•´ì„œ PCA ë°ì´í„°í”„ë ˆì„ì„ ê°€ì ¸ì˜¬ ê²ƒì´ë‹¤.<br>  

```py
# targetê³¼ feature data ì„¤ì •
cardio_target = cardio['cardio'].copy()
cardio_target[cardio_target==0] = 'N'
cardio_target[cardio_target==1] = 'Y'
cardio_feat = cardio.drop('cardio',axis = 1)  

# PCA Dataframe ì¶œë ¥
# ì‚¬ìš©í•˜ë ¤ëŠ” principal componenet ê°œìˆ˜ ì •ì˜
n_components = 4

pca = PCA(n_components=n_components)
components = pca.fit_transform(cardio)
PCA_df = pd.DataFrame({'PC1' : components[:,0],
             'PC2' : components[:,1],
             'PC3' : components[:,2],
             'PC4' : components[:,3],
             'cardio' : cardio['cardio']})
PCA_df
```  

<p align="center"><img src="https://user-images.githubusercontent.com/65170165/182032289-57f4c876-f37d-4cb3-9575-0af0ec376a15.png" width="700" /></p><br>  

***  

ğŸ ì´ë ‡ê²Œ í•´ì„œ í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  í•„ìš”í•œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ê³¼ì •ì„ ì‚´í´ë³´ì•˜ë‹¤.  

ğŸ ë‹¤ìŒ ê¸€ì—ì„œëŠ” Decision Treeë¥¼ í†µí•´ ë‘ ê²½ìš°ì˜ ì˜ˆì¸¡ë ¥ì„ ë¹„êµí•˜ê³  ì–´ë–¤ ë°©ë²•ì´ ë” ì¢‹ì€ì§€ ë¹„êµí•´ë³´ë„ë¡ í•˜ìğŸ˜ŠğŸ˜Š.  

***
